<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="news">
	<!-- 카테고리 -->
	<select id="news_category" resultType="category">
		select * from CATEGORY
	</select>

    <!-- 뉴스 등록 -->
    
    <insert id="news_insert" parameterType="news">
    
    
    	  INSERT INTO news values(
  						seq_news_idx.nextval,
						#{news_title},
						#{news_thumbnail_image},
						#{news_content},
						0,
						default,
						null,
						1, <!-- 멤버 idx 추후 변경필요(mem_idx) -->
						1 <!-- 카테고리 idx 추후변경필요(category_idx) -->
			)
		<selectKey resultType="int" keyProperty="news_idx" order="AFTER">
    		SELECT seq_news_idx.CURRVAL from dual
    	</selectKey>
    
    </insert>
    
      <!-- 삭제  -->
   <delete id="news_delete"  parameterType="int">
      delete from news where news_idx=#{ news_idx }
   </delete>
   
     <!-- 뉴스 수정시 조회 -->
    <select id="news_modify_select_one" resultType="news" parameterType="int">
        select * from news where news_idx=#{news_idx}
    </select>
    
    <!-- 수정하기 -->
  <update id="news_update"  parameterType="news">
      update news set news_title = #{news_title},
						news_thumbnail_image = #{news_thumbnail_image},
						news_content = #{news_content},
						news_updateAt = sysdate,
						category_idx = #{category_idx}
      where news_idx=#{news_idx}                   
  </update>
   
   <!-- 			구독 				-->
   
   <!-- 구독 확인 -->
    <select id="check_subscribe" resultType="int" parameterType="subscribe">
        SELECT COUNT(*) FROM subscribe
        WHERE mem_idx = #{mem_idx}
          AND reporter_idx = #{reporter_idx}
    </select>
    <!-- 구독 추가 -->
     <insert id="insert_subscribe" parameterType="hashMap">
        INSERT INTO subscribe
        VALUES (
                seq_news_like_idx.nextval,
                #{mem_idx},
                #{reporter_idx}
               )
    </insert>
    
     <!-- 구독 취소 ㅠ -->
    <delete id="delete_subscribe" parameterType="hashMap">
        DELETE FROM subscribe
         WHERE mem_idx = #{mem_idx}
           AND reporter_idx = #{reporter_idx}
    </delete>
    
    
   
</mapper>